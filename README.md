# ipac

hi, å¢™å†…çš„äººï¼

é¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯PACæ–‡ä»¶ï¼š<http://zh.wikipedia.org/zh/ä»£ç†è‡ªåŠ¨é…ç½®>

ipacæ ¹æ®[autoproxy2pac](http://autoproxy2pac.appspot.com/)çš„æœ€æ–°è§„åˆ™ç”Ÿæˆpacæ–‡ä»¶ï¼Œé€‚ç”¨äºå„ç§å¹³å°ï¼ˆpcï¼macï¼iPhoneç­‰æ”¯æŒPACè‡ªåŠ¨ä»£ç†çš„ç³»ç»Ÿï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ã€Œè‡ªåŠ¨ç¿»å¢™ã€äº†ã€‚

ipacæ˜¯ä¸€ä¸ªweb serverï¼Œç±»ä¼¼äº<http://autoproxy2pac.appspot.com/>ï¼Œå¯ä»¥æ ¹æ®å‚æ•°ç”Ÿæˆpacæ–‡ä»¶ï¼Œä½†æ˜¯æ˜¨å¤©ï¼ˆ2015-03-26ï¼‰æˆ‘ä½¿ç”¨çš„æ—¶å€™è¿™ä¸ªç½‘ç«™å·²ç»ä¸èƒ½ç”Ÿæˆpacæ–‡ä»¶äº†ï¼Œå¹¸å¥½è¿˜æœ‰ä¸€ä¸ª[gfwtest.js](http://autoproxy2pac.appspot.com/gfwtest.js)å¯ä»¥è®¿é—®ï¼Œæ‰€ä»¥`ipac`å°±æ˜¯æ ¹æ®è¿™ä¸ªjsæ–‡ä»¶ç”Ÿæˆpacæ ¼å¼æ–‡ä»¶çš„å¼€æºç¨‹åºã€‚

ipacå¹¶ä¸æ˜¯åƒ[goagent](https://github.com/goagent/goagent)é‚£æ ·æ˜¯ä¸€ä¸ªä»£ç†è½¯ä»¶ï¼Œä»–åªæ˜¯ä¸€ä¸ªè§„åˆ™ï¼Œå‘Šè¯‰ç³»ç»Ÿ(æµè§ˆå™¨)ä»€ä¹ˆæ—¶å€™ç”¨ä»£ç†(ç¿»å¢™)ï¼Œä»€ä¹ˆæ—¶å€™ä¸ç”¨ã€‚å¦‚æœä½ æƒ³ç¿»å¢™ï¼Œä»£ç†è½¯ä»¶è¿˜æ˜¯éœ€è¦çš„ã€‚

##å¿«é€Ÿä½¿ç”¨(å›¾ç‰‡ç‰ˆ)
- æ­å»ºä¸€ä¸ªä»£ç†æœåŠ¡å™¨(ä»¥sshä¸ºä¾‹)
	![ssh socksä»£ç†](http://100apps.github.io/ipac/startsocksproxy.gif)
- æµè§ˆå™¨è®¾ç½®(ä»¥firefoxä¸ºä¾‹)
	![firefox è®¾ç½®pac](http://100apps.github.io/ipac/ipac-firefox.gif)

##ä½¿ç”¨è¯´æ˜(æ–‡å­—ç‰ˆ)
ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘è‡ªå·±ç”¨ä¸€ä¸ªç¾å›½çš„VPSå½“è·³æ¿ï¼Œç”¨sshåšä»£ç†ã€‚æˆ‘åœ¨æˆ‘è‡ªå·±çš„æœºå™¨(iMac,ip:192.168.81.246)ä¸Šï¼Œè¿è¡Œ

	ssh -o GatewayPorts=yes -D 7071 -NT user@example.com

è¿™æ ·æœ¬æœºçš„7071ç«¯å£å°±æ˜¯ä¸€ä¸ªsocksä»£ç†äº†ã€‚æ³¨æ„å› ä¸ºç”¨äº†`-o GatewayPorts=yes`å‚æ•°ï¼Œæ‰€ä»¥å…¶ä»–æœºå™¨(æ¯”å¦‚æˆ‘çš„iPhone)ä¹Ÿèƒ½è®¿é—®iMacä¸Šçš„7071ç«¯å£äº†ã€‚å¦‚æœä½ ä½¿ç”¨äº†å…¶ä»–ä»£ç†è½¯ä»¶æ¯”å¦‚torï¼Œæœ€ç»ˆä¹Ÿæ˜¯å¾—åˆ°ä¸€ä¸ªå¯ä»¥å½“ï¼ˆsocksæˆ–è€…httpï¼‰ä»£ç†çš„ç«¯å£ã€‚

æˆ‘ä»¬ä»¥firefoxä¸ºä¾‹ï¼Œå¦‚æœæ­¤æ—¶åœ¨`ç½‘ç»œ`->`è®¾ç½®`->`æ‰‹åŠ¨é…ç½®ä»£ç†`->`SOCKSä¸»æœº`å¤„å¡«å†™192.168.81.246:7071ï¼ˆæ³¨æ„å‹¾é€‰`è¿œç¨‹DNS`é€‰é¡¹ï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶firefoxå…¨å±€éƒ½æ˜¯ä½¿ç”¨ä»£ç†çš„ï¼Œä½†æ˜¯è®¿é—®baiduï¼qqï¼æ·˜å®ä¹‹ç±»çš„å›½å†…ç½‘ç«™ä¸æƒ³ç”¨ä»£ç†ï¼Œæ­¤æ—¶`ipac`å°±æ´¾ä¸Šç”¨åœºäº†ï¼

åœ¨firefoxä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©`ç½‘ç»œ`->`è®¾ç½®`->`è‡ªåŠ¨ä»£ç†é…ç½®ï¼ˆPACï¼‰`ä¸­å¡«å…¥

	https://poiuy.me/socks192.168.81.246:7071

ç„¶åç‚¹å‡»ç¡®å®šï¼Œè¿™æ ·firefoxå°±èƒ½æŒ‰éœ€è‡ªåŠ¨ä»£ç†äº†ã€‚coolï¼

åŒæ ·çš„ï¼Œæ‰“å¼€iPhoneçš„`è®¾ç½®`->`Wi-Fi`->`â“˜`->`HTTPä»£ç†`->`è‡ªåŠ¨` å¡«å…¥
	
	https://poiuy.me/socks192.168.81.246:7071

æ­¤æ—¶iPhoneä¹Ÿèƒ½æŒ‰éœ€ä»£ç†äº†ã€‚å¿«æ¥ç”¨Safariæ‰“å¼€<https://www.twitter.com>è¯•è¯•å§ï¼

ä¸Šé¢çš„poiuy.meå°±æ˜¯ç”¨ipac.jsæ­å»ºçš„ã€‚æˆ‘åœ¨ä¸€å°ç¾å›½çš„VPSä¸Šè¿è¡Œ`./ipac.js 80`å°±å¯åŠ¨äº†ã€‚ipacä¸“é—¨ä¸º[cloudflare](https://www.cloudflare.com/)åšäº†ä¼˜åŒ–ï¼Œå¦‚æœåœ¨ipac.jsä¸­æŠŠç¬¬7è¡Œçš„`useCloudflareHttps`å€¼è®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆå°±ä¼šå¼ºåˆ¶ä½¿ç”¨cloudflareçš„httpsï¼Œè€Œä¸”å¦‚æœä¸æ˜¯cloudflareçš„è¯·æ±‚å°±ç›´æ¥æ‹’ç»ï¼Œä½¿PACæœåŠ¡å™¨æ›´å®‰å…¨ï¼Œæ›´éšè”½ã€‚

##ipacæ”¯æŒçš„å‚æ•°
	
	https://poiuy.me/socks192.168.81.246:7071 #ç”¨192.168.81.246:7071çš„SOCKSä»£ç†
	https://poiuy.me/proxy192.168.81.246:7071 #ç”¨192.168.81.246:7071çš„HTTPä»£ç†

æ‰€ä»¥å…¶å®åªæ”¯æŒä¸¤ä¸ªå‚æ•°ï¼Œ`socks`å’Œ`proxy`ï¼Œåé¢è·Ÿçš„æ˜¯`ip:port`ã€‚å¦‚æœä»€ä¹ˆå‚æ•°ä¹Ÿä¸åŠ ï¼Œå°±è¿”å›(template.pacä¸­å®šä¹‰çš„)é»˜è®¤ä»£ç†`SOCKS 127.0.0.1:7070`ï¼Œå½“ç„¶å¦‚æœæ˜¯è‡ªå·±è¿è¡Œçš„`ipac`ï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘`template.pac`ä¿®æ”¹ã€‚

##æƒ³æ·»åŠ è‡ªå®šä¹‰è§„åˆ™æ€ä¹ˆåŠï¼Ÿ
éœ€è¦è‡ªå·±è¿è¡Œ`ipac.js`ï¼Œä¿®æ”¹`template.pac`æ–‡ä»¶çš„`myHosts`å˜é‡ï¼Œé»˜è®¤æ˜¯è¿½åŠ hostsï¼Œå¯ä»¥é€šè¿‡`-host`æ¥ä»gfwlistä¸­å‡å»æŸä¸ªhostï¼Œæ¯”å¦‚`"-v2ex.com"`åˆ™å¯¹äºgfwlistä¸­çš„v2ex.comä¸ç”¨ä»£ç†ã€‚

##chromeæµè§ˆå™¨æ€ä¹ˆä½¿ç”¨
æˆ‘å¯ä»¥è´Ÿè´£ä»»çš„å‘Šè¯‰ä½ ï¼Œå¯ä»¥ç”¨ï¼ä½†æ˜¯å…·ä½“æ€ä¹ˆç”¨ï¼Œè¯·è‡ªè¡ŒGoogleï¼š`Chrome pacæ–‡ä»¶`ï¼Œ`Android pacæ–‡ä»¶`ï¼Œ`ie pacæ–‡ä»¶`ç­‰ã€‚

##æˆ‘çš„æœåŠ¡å™¨ä¸Šè¿è¡Œäº†å…¶ä»–webserverï¼Œè¿˜å¯ä»¥è·‘ipacå—ï¼Ÿ
å½“ç„¶å¯ä»¥ï¼ipacé»˜è®¤ç›‘å¬çš„æ˜¯55555ç«¯å£ï¼Œæ¯”å¦‚ä½ ç”¨nginxç›‘å¬80ç«¯å£ï¼Œé‚£ä¹ˆé…ç½®ä¸€ä¸ªnginxçš„åå‘ä»£ç†åˆ°127.0.0.1:5555å³å¯ã€‚å…·ä½“è§„åˆ™è¯·Googleï¼š`nginx åå‘ä»£ç†`ï¼Œ`apacheåå‘ä»£ç†`ç­‰ã€‚

##ç°åœ¨è¿™ä¹ˆå¤špacç”Ÿæˆé¡¹ç›®ï¼Œä½ å†å¼„ä¸€ä¸ªæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ
pacæœåŠ¡å™¨ï¼Œé¦–å…ˆè¦ä¿è¯èƒ½ç›´æ¥è®¿é—®ï¼Œä¸è¢«å¢™ã€‚æ‰€ä»¥ä¸€ä¸ªpacåœ°å€ä¸€æ—¦å‡ºåï¼Œå°±ä¼šè¢«å¢™ï¼Œä¸å¦‚å¼€æºä¸€ä¸ªpacæœåŠ¡å™¨ï¼Œå¤§å®¶è‡ªå»ºã€‚å¯ä»¥ç”¨æˆ‘ä»¬æä¾›çš„ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æœ¬æœºæä¸€ä¸ªï¼Œæˆ–è€…æ”¾åœ¨å¢™å†…çš„æœåŠ¡å™¨ä¸Šã€‚

å¦å¤–ï¼Œå¦‚æœä½ æƒ³åˆ†äº«è‡ªå·±çš„pacæœåŠ¡å™¨ï¼Œæ¬¢è¿pushè¿‡æ¥ã€‚

--------------
One More Thing

ipac.jsæ˜¯ç”¨[nodejs](https://nodejs.org)å†™çš„ï¼Œæ‰€ä»¥ä½ è¦æƒ³è¿è¡Œipac.jsï¼Œè¯·åœ¨è‡ªå·±çš„æœºå™¨ä¸Šå®‰è£…nodejsï¼Œæ¯”å¦‚ï¼š

- yum install nodejs
- apt-get install nodejs
- brew install nodejs
- ...

--------------
One More Thing, NO Kidding

##ä¸è¶Šç‹±çš„iPhoneä¹Ÿèƒ½ç”¨sshç¿»å¢™
æˆ‘ä»¬é¦–å…ˆä»App Storeä¸‹è½½ä¸€ä¸ªsshè½¯ä»¶ï¼Œæ¯”å¦‚æˆ‘ç”¨çš„æ˜¯[vSSH Lite](https://appsto.re/cn/iYe5F.i)ï¼Œé…ç½®-Då‚æ•°(ç«¯å£è½¬å‘ï¼Port Forwarding->Dynamic)ï¼Œæ¯”å¦‚7070ï¼Œé‚£ä¹ˆiPhoneçš„127.0.0.1:7070å°±æ˜¯ä¸€ä¸ªsocksä»£ç†äº†ã€‚æ­¤æ—¶å¡«å…¥è‡ªåŠ¨ä»£ç†è§„åˆ™åœ°å€`https://poiuy.me/`å°±å¯ä»¥äº†ã€‚ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§çº¦10åˆ†é’ŸiPhoneä¸Šçš„sshå®¢æˆ·ç«¯å°±ä¼šåœæ­¢ï¼Œéœ€è¦æ‰‹åŠ¨åˆ‡ä¸€ä¸‹åˆ°å‰å°ã€‚

å¦å¤–vSSHè¿˜æ”¯æŒ`Accept all connections`ï¼Œç›¸å½“äºsshçš„`-o GatewayPorts=yes`ï¼Œ å…¶ä»–è®¾å¤‡(ä½ çš„iPadï¼androidæ‰‹æœºï¼Œç”šè‡³ç”µè„‘)ä¹Ÿèƒ½ç”¨vSSHçš„socksä»£ç†äº†ã€‚å¯ä»¥æ‰“å¼€`è®¾ç½®`->`Wi-Fi`æŸ¥çœ‹ä½ çš„iPhoneçš„IPã€‚

##poiuy.meè¿™ä¸ªåŸŸåå¥½å¥‡æ€ªå•Š
éƒ½æ˜¯ä¸ºäº†è¾“å…¥æ–¹ä¾¿ã€‚poiuyæ˜¯iPhoneï¼ˆæˆ–å…¶ä»–æ‰‹æœºè®¾å¤‡ï¼‰å­—æ¯é”®ç›˜æœ€ä¸Šé¢ä¸€è¡Œï¼Œä»å³å‘å·¦çš„å‰5ä¸ªå­—æ¯ğŸ˜„ï¼Œæ‰€ä»¥è¾“å…¥ä¸€æ¬¡å°±è®°ä½äº†ã€‚

##æ¥¼ä¸»æˆ‘çœ‹äº†ä½ çš„ä»£ç ï¼Œæ„Ÿè§‰ä½ çš„jså†™å¾—å¾ˆçƒ‚
æ¥¼ä¸»æ˜¯ä¸“èŒåšiOS(Objective-C)å¼€å‘çš„ï¼Œjavascriptè¿˜å¤„äºå­¦ä¹ é˜¶æ®µï¼Œå†™å¾—ä¸å¥½ï¼Œè¯·è§è°…ã€‚ä½†æ˜¯ï¼Œä½ æƒ³ï¼Œå¥½æ­¹ï¼Œè¿™ä¸ªä¸œè¥¿å®ƒè·‘èµ·æ¥äº†ï¼ğŸ‘

##ç›®å‰å¯ç”¨çš„ipacæœåŠ¡å™¨åœ°å€ï¼š
1. https://poiuy.me/
2. æ¬¢è¿æ·»åŠ 

##support
- [![Join the chat at https://gitter.im/100apps/ipac](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/100apps/ipac?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)
